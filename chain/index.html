<!DOCTYPE html>
<html>
	<head>
		<link href="http://fonts.googleapis.com/css?family=Inconsolata:400,700" rel="stylesheet" type="text/css">
		<link href="http://fonts.googleapis.com/css?family=Crimson+Text:400,700" rel="stylesheet" type="text/css">
		<link href="styles.css" rel="stylesheet" type="text/css">
		<link href="ascetic.css" rel="stylesheet" type="text/css">
	</head>
	<body>
		<ul>
<li><a href="#markdown-header-chain">Chain</a></li>
<li><a href="#markdown-header-java">Java</a></li>
<li><a href="#markdown-header-javascript">JavaScript</a></li>
<li><a href="#markdown-header-lua">Lua</a></li>
<li><a href="#markdown-header-cpp">Cpp</a></li>
</ul>
<h1 id="markdown-header-chain">Chain</h1><h2 id="markdown-header-tiny-asynchronous-code-pipelining">tiny asynchronous code pipelining</h2><p>Chain is a collection of small code snippets to help you avoid callback hell.
It helps you to chain your callbacks easily, pass values from one callback to another and to cancel the chain of callbacks if needed. General API is as follows:</p>
<ul>
<li>Create a new chain: <code>chain = new Chain()</code></li>
<li>Add new funtions to the chain: <code>chain.then(f1).then(f2)</code></li>
<li>Add optional error handler: <code>chain.fail(f)</code></li>
<li>Start chain execution: <code>chain.done()</code></li>
</ul>
<p>Every callback receives the chain instance as its argument which allows you to:</p>
<ul>
<li>Pass a value to the next chained callback: <code>c.done(value)</code></li>
<li>Cancel chain: <code>c.cancel()</code></li>
<li>Throw an error (in this case an error handler will be called): <code>c.cancel(error)</code></li>
</ul>
<h3 id="markdown-header-java">Java</h3><p>Java version is implemented as a single class and chain can pass values of only
one type <T>. You can use containers like Pair<A,B> or Object type
if you need more flexibility. Chain error class must implement Throwable.</p>
<p>Java 8 is not required at all, but it will make writing your callbacks so much
easier. Android is supported, too.</p>
<pre><code class="lang-java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Example</span> </span>{

    <span class="hljs-keyword">private</span> <span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">Callback</span>&lt;<span class="hljs-title">T</span>&gt; </span>{
        <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">run</span><span class="hljs-params">(T arg, Exception e)</span></span>;
    }
    <span class="hljs-comment">// A long-running method to get the Answer to The Ultimate Question of</span>
    <span class="hljs-comment">// Life, the Universe, and Everything</span>
    <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">getAnswer</span><span class="hljs-params">(Callback&lt;Integer&gt; cb)</span> </span>{
        cb.run(<span class="hljs-number">42</span>, <span class="hljs-keyword">null</span>);
    }
    <span class="hljs-comment">// A long-running method to get the actual Question</span>
    <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">getQuestion</span><span class="hljs-params">(Callback&lt;String&gt; cb)</span> </span>{
        cb.run(<span class="hljs-keyword">null</span>, <span class="hljs-keyword">new</span> RuntimeException(<span class="hljs-string">"Oops, the earth has been destroyed"</span>));
    }

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String args[])</span> </span>{
        <span class="hljs-keyword">new</span> Chain&lt;&gt;().then((c) -&gt; {
            getAnswer((answer, err) -&gt; {
                System.out.println(<span class="hljs-string">"Answer is: "</span> + answer);
                c.done(answer);
            });
        }).then((c) -&gt; {
            getQuestion((question, err) -&gt; {
                <span class="hljs-keyword">if</span> (err != <span class="hljs-keyword">null</span>) {
                    c.cancel(err);
                } <span class="hljs-keyword">else</span> {
                    c.done();
                }
            });
        }).fail((c, err) -&gt; {
            System.out.println(<span class="hljs-string">"Error: "</span> + err);
        }).done();
    }
}
</code></pre>
<p><a href="https://bitbucket.org/trikita/chain/raw/tip/java/Example.java">Example</a></p>
<p><a href="https://bitbucket.org/trikita/chain/raw/tip/java/Chain.java">Code</a></p>
<h3 id="markdown-header-javascript">JavaScript</h3><p>Javascript version supports both Node.js and browser (including IE6+)</p>
<p>There is also a very limited, but very tiny version (tweet-size, 140 bytes).
It lacks error and value passing. It&#39;s here for historical reasons as it is
the very first version of Chain.</p>
<pre><code class="lang-js"><span class="hljs-keyword">var</span> chain = <span class="hljs-built_in">require</span>(<span class="hljs-string">'./chain'</span>); <span class="hljs-comment">// In the browser it will be window.chain</span>

<span class="hljs-comment">// A long-running function to get the Answer to The Ultimate Question of</span>
<span class="hljs-comment">// Life, the Universe, and Everything</span>
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getAnswer</span><span class="hljs-params">(cb)</span> </span>{
    cb(<span class="hljs-number">42</span>);
}
<span class="hljs-comment">// A long-running function to get the actual Question</span>
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getQuestion</span><span class="hljs-params">(cb)</span> </span>{
    cb(<span class="hljs-literal">null</span>, <span class="hljs-string">'Oops, the earth has been destroyed'</span>);
}

chain().then(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(c)</span> </span>{
    getAnswer(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(answer, err)</span> </span>{
        <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'The answer is:'</span>, answer);
        c.done(answer);
    });
}).then(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(c)</span> </span>{
    getQuestion(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(question, err)</span> </span>{
        <span class="hljs-keyword">if</span> (err) {
            c.cancel(err);
        } <span class="hljs-keyword">else</span> {
            <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'The question is:'</span>, question);
            c.done();
        }
    });
}).fail(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(c, err)</span> </span>{
    <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'Error message:'</span>, err);
}).done();
</code></pre>
<p><a href="https://bitbucket.org/trikita/chain/raw/tip/js/example.js">Example</a></p>
<p><a href="https://bitbucket.org/trikita/chain/raw/tip/js/chain.js">Code</a></p>
<h3 id="markdown-header-lua">Lua</h3><p>Lua version is very similar to javascript, support all modern Lua versions,
including 5.0, 5.1, 5.2 and LuaJIT.</p>
<pre><code class="lang-lua"><span class="hljs-keyword">local</span> chain = <span class="hljs-built_in">require</span>(<span class="hljs-string">'chain'</span>)

<span class="hljs-comment">-- A long-running function to get the Answer to The Ultimate Question of</span>
<span class="hljs-comment">-- Life, the Universe, and Everything</span>
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getanswer</span><span class="hljs-params">(cb)</span></span> cb(<span class="hljs-number">42</span>) <span class="hljs-keyword">end</span>
<span class="hljs-comment">-- A long-running function to get the actual Question</span>
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getquestion</span><span class="hljs-params">(cb)</span></span> cb(<span class="hljs-keyword">nil</span>, <span class="hljs-string">'Oops, the earth has been destroyed'</span>) <span class="hljs-keyword">end</span>

chain():<span class="hljs-built_in">next</span>(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(c)</span></span>
    getanswer(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(answer, error)</span></span>
        <span class="hljs-built_in">print</span>(<span class="hljs-string">'The answer is:'</span>, answer)
        c:done(answer)
    <span class="hljs-keyword">end</span>)
<span class="hljs-keyword">end</span>):<span class="hljs-built_in">next</span>(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(c)</span></span>
    getquestion(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(question, error)</span></span>
        <span class="hljs-keyword">if</span> <span class="hljs-built_in">error</span> ~= <span class="hljs-keyword">nil</span> <span class="hljs-keyword">then</span>
            c:cancel(<span class="hljs-built_in">error</span>)
        <span class="hljs-keyword">else</span>
            <span class="hljs-built_in">print</span>(<span class="hljs-string">'The question is:'</span>, question)
            c:done()
        <span class="hljs-keyword">end</span>
    <span class="hljs-keyword">end</span>)
<span class="hljs-keyword">end</span>):fail(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(c, error)</span></span>
    <span class="hljs-built_in">print</span>(<span class="hljs-string">'Error message:'</span>, <span class="hljs-built_in">error</span>)
<span class="hljs-keyword">end</span>):done()
</code></pre>
<p><a href="https://bitbucket.org/trikita/chain/raw/tip/lua/example.lua">Example</a></p>
<p><a href="https://bitbucket.org/trikita/chain/raw/tip/lua/chain.lua">Code</a></p>
<h3 id="markdown-header-cpp">Cpp</h3><p>This version uses closures, so your compiler should support C++11. If you want to terminate chain with an error - it should be a child of the std::exception class.</p>
<pre><code class="lang-cpp"><span class="hljs-preprocessor">#<span class="hljs-keyword">include</span> &lt;iostream&gt;</span>
<span class="hljs-preprocessor">#<span class="hljs-keyword">include</span> &lt;string&gt;</span>
<span class="hljs-preprocessor">#<span class="hljs-keyword">include</span> "chain.hpp"</span>

<span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">getAnswer</span><span class="hljs-params">(<span class="hljs-built_in">std</span>::function&lt;<span class="hljs-keyword">void</span>(<span class="hljs-keyword">int</span>)</span>&gt; cb) </span>{
    cb(<span class="hljs-number">42</span>);
}
<span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">getQuestion</span><span class="hljs-params">(<span class="hljs-built_in">std</span>::function&lt;<span class="hljs-keyword">void</span>(<span class="hljs-keyword">const</span> <span class="hljs-built_in">std</span>::<span class="hljs-built_in">string</span>&amp; question, <span class="hljs-built_in">std</span>::exception_ptr)</span>&gt; cb) </span>{
    cb(<span class="hljs-string">""</span>, std::make_exception_ptr(std::runtime_error(<span class="hljs-string">"Oops, the earth has been destroyed"</span>)));
}

<span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span> </span>{
    Chain&lt;<span class="hljs-keyword">int</span>&gt;().then([](Chain&lt;<span class="hljs-keyword">int</span>&gt;&amp; c) {
        getAnswer([&amp;](<span class="hljs-keyword">int</span> answer) {
            std::<span class="hljs-built_in">cout</span> &lt;&lt; <span class="hljs-string">"Answer: "</span> &lt;&lt; answer &lt;&lt; std::endl;
            c.done(answer);
        });
    }).then([](Chain&lt;<span class="hljs-keyword">int</span>&gt;&amp; c) {
        getQuestion([&amp;](<span class="hljs-keyword">const</span> std::<span class="hljs-built_in">string</span>&amp; question, std::exception_ptr err) {
            <span class="hljs-keyword">if</span> (err) {
                c.cancel(err);
            } <span class="hljs-keyword">else</span> {
                c.done(); <span class="hljs-comment">// Pass current chain value</span>
            }
        });
    }).fail([](Chain&lt;<span class="hljs-keyword">int</span>&gt;&amp; c, std::exception_ptr err) {
        <span class="hljs-keyword">try</span> {
            std::rethrow_exception(err);
        } <span class="hljs-keyword">catch</span>(std::exception&amp; e) {
        std::<span class="hljs-built_in">cout</span> &lt;&lt; <span class="hljs-string">"Error: "</span> &lt;&lt; e.what() &lt;&lt; std::endl;
        }
    }).done();
    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
}
</code></pre>
<p><a href="https://bitbucket.org/trikita/chain/raw/tip/cpp/example.cpp">Example</a></p>
<p><a href="https://bitbucket.org/trikita/chain/raw/tip/cpp/chain.hpp">Code</a></p>
<p>Special thanks to Anton Tanchuk, Jason LeBlanc and other contributors.
Code licensed under the MIT license. Sources repository is available at <a href="http://bitbucket.org/trikita/chain">http://bitbucket.org/trikita/chain</a></p>

		<a href="https://bitbucket.org/trikita/knork" style="position:absolute;z-index:10000;top:0;right:0;">
			<img src="https://bitbucket.org/zgramana/bitbucket-ribbons/raw/988dffc5fbeb/png/bitbucket-ribbon-gray.png">
		</a>
		<script src="app.js"></script>
	</body>
</html>

