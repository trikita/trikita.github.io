<!DOCTYPE html><html><head><title>Chain | Micro-promises for Java, JavaScript, Lua and C++</title><link href="http://fonts.googleapis.com/css?family=Inconsolata:400,700" rel="stylesheet" type="text/css"><link href="http://fonts.googleapis.com/css?family=Crimson+Text:400,700" rel="stylesheet" type="text/css"><link href="styles.css" rel="stylesheet" type="text/css"><link href="ascetic.css" rel="stylesheet" type="text/css"></head><body><ul>
<li><a href="#markdown-header-chain">Chain</a></li>
<li><a href="#markdown-header-java">Java</a></li>
<li><a href="#markdown-header-javascript">JavaScript</a></li>
<li><a href="#markdown-header-lua">Lua</a></li>
<li><a href="#markdown-header-cpp">Cpp</a></li>
</ul>
<h1 id="chain">Chain</h1>
<h2 id="tiny-asynchronous-code-pipelining">tiny asynchronous code pipelining</h2>
<p>Chain is a collection of small code snippets to help you avoid callback hell.
It helps you to chain your callbacks easily, pass values from one callback to another and to cancel the chain of callbacks if needed. General API is as follows:</p>
<ul>
<li>Create a new chain: <code>chain = new Chain()</code></li>
<li>Add new funtions to the chain: <code>chain.then(f1).then(f2)</code></li>
<li>Add optional error handler: <code>chain.fail(f)</code></li>
<li>Start chain execution: <code>chain.done()</code></li>
</ul>
<p>Every callback receives the chain instance as its argument which allows you to:</p>
<ul>
<li>Pass a value to the next chained callback: <code>c.done(value)</code></li>
<li>Cancel chain: <code>c.cancel()</code></li>
<li>Throw an error (in this case an error handler will be called): <code>c.cancel(error)</code></li>
</ul>
<h3 id="java">Java</h3>
<p>Java version is implemented as a single class and chain can pass values of only
one type <T>. You can use containers like Pair<A,B> or Object type
if you need more flexibility. Chain error class must implement Throwable.</p>
<p>Java 8 is not required at all, but it will make writing your callbacks so much
easier. Android is supported, too.</p>
<pre><code class="language-java">public class Example {

    private interface Callback&lt;T&gt; {
        public void run(T arg, Exception e);
    }
    // A long-running method to get the Answer to The Ultimate Question of
    // Life, the Universe, and Everything
    private static void getAnswer(Callback&lt;Integer&gt; cb) {
        cb.run(42, null);
    }
    // A long-running method to get the actual Question
    private static void getQuestion(Callback&lt;String&gt; cb) {
        cb.run(null, new RuntimeException(&quot;Oops, the earth has been destroyed&quot;));
    }

    public static void main(String args[]) {
        new Chain&lt;&gt;().then((c) -&gt; {
            getAnswer((answer, err) -&gt; {
                System.out.println(&quot;Answer is: &quot; + answer);
                c.done(answer);
            });
        }).then((c) -&gt; {
            getQuestion((question, err) -&gt; {
                if (err != null) {
                    c.cancel(err);
                } else {
                    c.done();
                }
            });
        }).fail((c, err) -&gt; {
            System.out.println(&quot;Error: &quot; + err);
        }).done();
    }
}
</code></pre>
<p><a href="https://bitbucket.org/trikita/chain/raw/tip/java/Example.java">Example</a></p>
<p><a href="https://bitbucket.org/trikita/chain/raw/tip/java/Chain.java">Code</a></p>
<h3 id="javascript">JavaScript</h3>
<p>Javascript version supports both Node.js and browser (including IE6+)</p>
<p>There is also a very limited, but very tiny version (tweet-size, 140 bytes).
It lacks error and value passing. It&#39;s here for historical reasons as it is
the very first version of Chain.</p>
<pre><code class="language-js">var chain = require(&#39;./chain&#39;); // In the browser it will be window.chain

// A long-running function to get the Answer to The Ultimate Question of
// Life, the Universe, and Everything
function getAnswer(cb) {
    cb(42);
}
// A long-running function to get the actual Question
function getQuestion(cb) {
    cb(null, &#39;Oops, the earth has been destroyed&#39;);
}

chain().then(function(c) {
    getAnswer(function(answer, err) {
        console.log(&#39;The answer is:&#39;, answer);
        c.done(answer);
    });
}).then(function(c) {
    getQuestion(function(question, err) {
        if (err) {
            c.cancel(err);
        } else {
            console.log(&#39;The question is:&#39;, question);
            c.done();
        }
    });
}).fail(function(c, err) {
    console.log(&#39;Error message:&#39;, err);
}).done();
</code></pre>
<p><a href="https://bitbucket.org/trikita/chain/raw/tip/js/example.js">Example</a></p>
<p><a href="https://bitbucket.org/trikita/chain/raw/tip/js/chain.js">Code</a></p>
<h3 id="lua">Lua</h3>
<p>Lua version is very similar to javascript, support all modern Lua versions,
including 5.0, 5.1, 5.2 and LuaJIT.</p>
<pre><code class="language-lua">local chain = require(&#39;chain&#39;)

-- A long-running function to get the Answer to The Ultimate Question of
-- Life, the Universe, and Everything
function getanswer(cb) cb(42) end
-- A long-running function to get the actual Question
function getquestion(cb) cb(nil, &#39;Oops, the earth has been destroyed&#39;) end

chain():next(function(c)
    getanswer(function(answer, error)
        print(&#39;The answer is:&#39;, answer)
        c:done(answer)
    end)
end):next(function(c)
    getquestion(function(question, error)
        if error ~= nil then
            c:cancel(error)
        else
            print(&#39;The question is:&#39;, question)
            c:done()
        end
    end)
end):fail(function(c, error)
    print(&#39;Error message:&#39;, error)
end):done()
</code></pre>
<p><a href="https://bitbucket.org/trikita/chain/raw/tip/lua/example.lua">Example</a></p>
<p><a href="https://bitbucket.org/trikita/chain/raw/tip/lua/chain.lua">Code</a></p>
<h3 id="cpp">Cpp</h3>
<p>This version uses closures, so your compiler should support C++11. If you want to terminate chain with an error - it should be a child of the std::exception class.</p>
<pre><code class="language-cpp">#include &lt;iostream&gt;
#include &lt;string&gt;
#include &quot;chain.hpp&quot;

static void getAnswer(std::function&lt;void(int)&gt; cb) {
    cb(42);
}
static void getQuestion(std::function&lt;void(const std::string&amp; question, std::exception_ptr)&gt; cb) {
    cb(&quot;&quot;, std::make_exception_ptr(std::runtime_error(&quot;Oops, the earth has been destroyed&quot;)));
}

int main() {
    Chain&lt;int&gt;().then([](Chain&lt;int&gt;&amp; c) {
        getAnswer([&amp;](int answer) {
            std::cout &lt;&lt; &quot;Answer: &quot; &lt;&lt; answer &lt;&lt; std::endl;
            c.done(answer);
        });
    }).then([](Chain&lt;int&gt;&amp; c) {
        getQuestion([&amp;](const std::string&amp; question, std::exception_ptr err) {
            if (err) {
                c.cancel(err);
            } else {
                c.done(); // Pass current chain value
            }
        });
    }).fail([](Chain&lt;int&gt;&amp; c, std::exception_ptr err) {
        try {
            std::rethrow_exception(err);
        } catch(std::exception&amp; e) {
        std::cout &lt;&lt; &quot;Error: &quot; &lt;&lt; e.what() &lt;&lt; std::endl;
        }
    }).done();
    return 0;
}
</code></pre>
<p><a href="https://bitbucket.org/trikita/chain/raw/tip/cpp/example.cpp">Example</a></p>
<p><a href="https://bitbucket.org/trikita/chain/raw/tip/cpp/chain.hpp">Code</a></p>
<p>Special thanks to Anton Tanchuk, Jason LeBlanc and other contributors.
Code licensed under the MIT license. Sources repository is available at <a href="http://bitbucket.org/trikita/chain">http://bitbucket.org/trikita/chain</a></p>
<a href="https://bitbucket.org/trikita/chain" style="position:absolute;z-index:10000;top:0;right:0;"><img src="https://bitbucket.org/zgramana/bitbucket-ribbons/raw/988dffc5fbeb/png/bitbucket-ribbon-gray.png"></a><script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/8.5/highlight.min.js"></script><script>hljs.initHighlightingOnLoad();</script><script src="app.js"></script></body></html>